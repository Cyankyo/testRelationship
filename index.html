<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>çµæ•°CPåŒ¹é…æµ‹è¯• â¤</title>
    <style>
        /* ä¿æŒåŸæœ‰æ ·å¼ä¸å˜ */
        body { 
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        /* å…¶ä»–æ ·å¼ä¿æŒä¸å˜... */
    </style>
</head>
<body>
    <div class="container">
        <h1>â¤ çµæ•°ç¼˜åˆ†æµ‹è¯•å™¨ â¤</h1>
        <div class="input-group">
            <input type="text" id="name1" placeholder="è¾“å…¥ç¬¬ä¸€ä¸ªåå­—">
            <input type="text" id="name2" placeholder="è¾“å…¥ç¬¬äºŒä¸ªåå­—">
        </div>
        <button id="calculateBtn" disabled>åŠ è½½ç¬”ç”»æ•°æ®ä¸­...</button>
        <div id="result" style="opacity:0">
            <div class="heart">â¤â¤</div>
            <div class="steps"></div>
            <div class="percentage"></div>
            <div class="message"></div>
            <div class="heart">â¤â¤</div>
        </div>
        <div id="loading" style="margin-top:20px">
            <p>æ­£åœ¨åŠ è½½ç¬”ç”»æ•°æ®åº“...</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨ç¬”ç”»æ•°æ®
        let strokeDatabase = {};
        let isDataLoaded = false;

        // å¼‚æ­¥åŠ è½½JSONæ•°æ®
        async function loadStrokeData() {
		 const data
            try {
                  fetch('stroke-data.json') // æ›¿æ¢ä¸ºä½ çš„ JSON æ–‡ä»¶è·¯å¾„
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
        })
        .catch(error => {
            console.error('There was a problem loading the JSON file:', error);
        });
                strokeDatabase = data.data;
                isDataLoaded = true;
                
                document.getElementById('calculateBtn').disabled = false;
                document.getElementById('calculateBtn').textContent = "ç«‹å³æµ‹ç®—";
                document.getElementById('loading').innerHTML = 
                    `<p style="color:green">âœ” å·²åŠ è½½${Object.keys(strokeDatabase).length}ä¸ªæ±‰å­—ç¬”ç”»æ•°æ®</p>`;
                
                console.log('ç¬”ç”»æ•°æ®åŠ è½½å®Œæˆ');
            } catch (error) {
                console.error('åŠ è½½ç¬”ç”»æ•°æ®å¤±è´¥:', error);
                document.getElementById('loading').innerHTML = 
                    `<p style="color:red">âœ– åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', () => {
            loadStrokeData();
        });

        // è®¡ç®—å‡½æ•°
        function calculateLoveNumber() {
            if (!isDataLoaded) {
                alert("ç¬”ç”»æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•");
                return;
            }

            const name1 = document.getElementById('name1').value.trim();
            const name2 = document.getElementById('name2').value.trim();

            if (!name1 || !name2) {
                alert("è¯·è¾“å…¥ä¸¤ä¸ªåå­—å“¦~");
                return;
            }

            // æ£€æŸ¥ç”Ÿåƒ»å­—
            const checkChars = (name) => {
                return [...name].filter(char => !strokeDatabase[char]);
            };
            
            const unknownChars1 = checkChars(name1);
            const unknownChars2 = checkChars(name2);
            
            if (unknownChars1.length > 0 || unknownChars2.length > 0) {
                alert(`ä»¥ä¸‹æ–‡å­—æš‚æœªæ”¶å½•ï¼š\n${name1}: ${unknownChars1.join('')}\n${name2}: ${unknownChars2.join('')}`);
                return;
            }

            // è®¡ç®—æ€»ç¬”ç”»æ•°
            const getTotal = name => [...name].reduce((sum, char) => sum + strokeDatabase[char], 0);
            const total1 = getTotal(name1);
            const total2 = getTotal(name2);

            // è·å–ä¸ªä½æ•°
            let digit1 = total1 % 10;
            let digit2 = total2 % 10;
            
            // è®¡ç®—è¿‡ç¨‹è®°å½•
            let processSteps = [
                `ã€Œ${name1}ã€æ€»ç¬”ç”»ï¼š${total1} â†’ ä¸ªä½æ•° ${digit1}`,
                `ã€Œ${name2}ã€æ€»ç¬”ç”»ï¼š${total2} â†’ ä¸ªä½æ•° ${digit2}`
            ];

            // æ ¸å¿ƒç®—æ³•
            let currentSum = digit1 + digit2;
            processSteps.push(`åˆæ¬¡ç›¸åŠ ï¼š${digit1} + ${digit2} = ${currentSum}`);

            // å¾ªç¯ç›¸åŠ ç›´åˆ°ä¸ªä½æ•°
            while (currentSum >= 10) {
                const newDigit1 = Math.floor(currentSum / 10);
                const newDigit2 = currentSum % 10;
                currentSum = newDigit1 + newDigit2;
                processSteps.push(`ç»§ç»­è®¡ç®—ï¼š${newDigit1} + ${newDigit2} = ${currentSum}`);
            }

            // æ˜¾ç¤ºç»“æœ
            showResult(currentSum, processSteps);
        }

        // æ˜¾ç¤ºç»“æœå‡½æ•°ä¿æŒä¸å˜...
        function showResult(finalNumber, steps) {
            const messages = {
                9: ["å¤©ä½œä¹‹åˆ", "ğŸ‘‘ ä¹ä¸–è‰¯ç¼˜ï¼å¤©å®šå§»ç¼˜ï¼"],
                8: ["ç›¸æ¿¡ä»¥æ²«", "ğŸ’ å…«æ–¹æ¥è´¢ï¼é•¿ä¹…ç¨³å®šï¼"],
                7: ["çµé­‚ä¼´ä¾£", "ğŸ”® ä¸ƒçªç²ç‘ï¼é»˜å¥‘åè¶³ï¼"],
                6: ["ç”œèœœæ¸©é¦¨", "ğŸ¯ å…­åˆç¾æ»¡ï¼å¦‚èƒ¶ä¼¼æ¼†ï¼"],
                5: ["æ¬¢å–œå†¤å®¶", "ğŸ­ äº”è¡Œç›¸ç”Ÿï¼æ´»åŠ›æ»¡æ»¡ï¼"],
                4: ["ç»†æ°´é•¿æµ", "ğŸŒŠ å››å­£å¹³å®‰ï¼ç¨³å®šå‘å±•ï¼"],
                3: ["æµªæ¼«æ¿€æƒ…", "ğŸ”¥ ä¸‰ç”Ÿæœ‰å¹¸ï¼çƒ­æƒ…ä¼¼ç«ï¼"],
                2: ["äº’è¡¥æˆé•¿", "ğŸŒ± é˜´é˜³è°ƒå’Œï¼å…±åŒè¿›æ­¥ï¼"],
                1: ["ç‹¬ä¸€æ— äºŒ", "ğŸ’˜ ä¸€å¿ƒä¸€æ„ï¼å‘½ä¸­æ³¨å®šï¼"],
                0: ["å¥‡å¦™ç¼˜åˆ†", "ğŸŒˆ å½’é›¶é‡ç”Ÿï¼æ— é™å¯èƒ½ï¼"]
            };

            document.querySelector('.steps').innerHTML = 
                `<div class="calculation-process">${steps.join('<br>')}</div>`;
            document.querySelector('.percentage').innerHTML = 
                `ç¼˜åˆ†çµæ•°ï¼š<span style="font-size:2em">${finalNumber}</span>`;
            document.querySelector('.message').innerHTML = 
                `<h3>${messages[finalNumber][0]}</h3>${messages[finalNumber][1]}`;
            document.getElementById('result').style.opacity = '1';
        }

        // ç»‘å®šè®¡ç®—æŒ‰é’®äº‹ä»¶
        document.getElementById('calculateBtn').addEventListener('click', calculateLoveNumber);
    </script>
</body>
</html>